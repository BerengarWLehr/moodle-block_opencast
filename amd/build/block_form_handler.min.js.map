{"version":3,"sources":["../src/block_form_handler.js"],"names":["define","$","window","presenterIntervalHandle","presentationIntervalHandle","presenterRun","presentationRun","afterUpload","clearInterval","removeAttr","autocompletePrettifier","each","i","elm","input","find","hasClass","addClass","setDefautlTitle","filename","title","val","split","Array","isArray","pop","length","join","getFilenameFromFilelist","filelist","filelinks","text","init","hide","on","e","toggle","preventDefault","setTimeout","span","currentTarget","siblings","parent","video_identifier","attr","setInterval"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the opencast block.\n *\n * @package    block_opencast\n * @copyright  2019 Farbod Zamani (zamani@elan-ev.de)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function ($) {\n    /**\n     * Instantiate the window variable in order to work with Intervals\n     *\n     */\n    window.presenterIntervalHandle = null;\n    window.presentationIntervalHandle = null;\n    window.presenterRun = false;\n    window.presentationRun = false;\n\n    /**\n     * Clears intervals and enables Save Change Button after upload process is completed\n     *\n     */\n    function afterUpload() {\n        if (!window.presentationRun && !window.presenterRun) {\n            clearInterval(window.presentationIntervalHandle);\n            clearInterval(window.presenterIntervalHandle);\n            $('[name=\"submitbutton\"]').removeAttr('disabled');\n        }\n    }\n\n    /**\n     * Makes sure that autocomplete fields receive the form-control class in order to have consistency\n     *\n     */\n    function autocompletePrettifier() {\n        $('div[data-fieldtype=\"autocomplete\"]').each(function (i, elm) {\n            var input = $(elm).find('input');\n            if (!input.hasClass('form-control')) {\n                input.addClass('form-control');\n            }\n        });\n    }\n\n    /**\n     * Sets default title if it is empty.\n     *\n     */\n    function setDefautlTitle(filename) {\n        var title = $('input[name=\"title\"]').val();\n        if (!title && filename) {\n            // Removing the extension from the filename.\n            var filename = filename.split('.');\n            if (Array.isArray(filename)) {\n                filename.pop();\n            }\n            filename = filename.length > 1 ? filename.join('.') : filename[0];\n            $('input[name=\"title\"]').val(filename);\n        }\n    }\n\n    /**\n     * Extracts the filename from filelist.\n     *\n     */\n    function getFilenameFromFilelist(filelist) {\n        var filename = '';\n        if (filelist.length) {\n            var filelinks = filelist.find('.filepicker-filename > a');\n            filename = filelinks.length ? $(filelinks[0]).text() : '';\n        }\n        return filename;\n    }\n\n    /**\n     * Initialise all of the modules for the opencast block.\n     *\n     */\n    var init = function () {\n        // Toggle visibility of terms of use\n        $('#termsofuse').hide();\n        $('#termsofuse_toggle').on('click', function (e) {\n            $('#termsofuse').toggle();\n            e.preventDefault();\n        });\n\n        // Chunkupload.\n        $('.local_chunkupload input[type=\"file\"]').on('change', function (e) {\n            setTimeout(function () {\n                var span = $(e.currentTarget).siblings('label.chunkupload-label').find('.chunkupload-filename');\n                if (span.length) {\n                    setDefautlTitle($(span[0]).text());\n                }\n            }, 500);\n        });\n\n        $('.filepickerhidden').on('change', function (e) {\n            setTimeout(function () {\n                var filelist = $(e.currentTarget).parent().find('.filepicker-filelist');\n                var filename = getFilenameFromFilelist(filelist);\n                setDefautlTitle(filename);\n            }, 500);\n        });\n\n        $('.filepicker-filelist').on('drop', function (e) {\n            var filelist = e.currentTarget;\n            var video_identifier = $(filelist).parent().siblings('.filepickerhidden').attr('name');\n\n            $('[name=\"submitbutton\"]').attr('disabled', 'disabled');\n\n            if (video_identifier == 'video_presenter') {\n                $(filelist).addClass('presenter-uploading');\n                window.presenterIntervalHandle = setInterval(function () {\n                    window.presenterRun = true;\n                    if (!$('.presenter-uploading').hasClass('dndupload-inprogress')) {\n                        window.presenterRun = false;\n                        afterUpload();\n                    }\n                }, 500);\n            } else {\n                $(filelist).addClass('presentation-uploading');\n                window.presenterIntervalHandle = setInterval(function () {\n                    window.presentationRun = true;\n                    if (!$('.presentation-uploading').hasClass('dndupload-inprogress')) {\n                        window.presentationRun = false;\n                        afterUpload();\n                    }\n                }, 500);\n            }\n\n            setTimeout(function () {\n                var filename = getFilenameFromFilelist(filelist);\n                setDefautlTitle(filename);\n            }, 500);\n        });\n\n        // Ensures that autocomplete fields are loaded properly after 1 sec!\n        setTimeout(function () {\n            autocompletePrettifier();\n            $('.moreless-actions').on('click', function () { //\n                autocompletePrettifier();\n            });\n        }, 1000);\n    };\n\n    return {\n        init: init\n    };\n});\n\n"],"file":"block_form_handler.min.js"}