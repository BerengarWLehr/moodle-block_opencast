{"version":3,"sources":["../src/block_manage_series.js"],"names":["getBody","contextid","ocinstanceid","seriesid","formdata","params","jsonformdata","Fragment","loadFragment","submitFormAjax","e","preventDefault","modal","data","seriestable","window","edited","numseriesallowed","changeEvent","document","createEvent","initEvent","getRoot","find","each","index","element","dispatchEvent","invalid","$","merge","length","first","focus","formData","serialize","seriestitle","val","Ajax","call","methodname","args","done","newseries","destroy","row","getRows","r","getData","series","update","s","JSON","parse","addRow","isdefault","hide","fail","er","errorcode","displayError","message","setBody","Templates","render","announce","closebutton","extraclasses","then","m","append","Notification","alert","loadSeriesTitles","stringify","titles","forEach","error","init","str","get_strings","key","component","jsstrings","seriesinput","Tabulator","layout","placeholder","headerSort","dataChanged","filter","value","reduce","arr","x","dataLoaded","map","columns","title","field","editable","hozAlign","widthGrow","formatter","cell","input","createElement","type","name","checked","getValue","classList","add","addEventListener","ModalFactory","create","types","SAVE_CANCEL","body","on","ModalEvents","hidden","bind","save","getRow","getTable","show","width","cellClick","_","getCell","setSaveButtonText","setLarge","shown","submit","result","res","delete","removeClass","click","context","label","required","advanced","wrapperid","id","size"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the opencast block settings.\n *\n * @package    block_opencast\n * @copyright  2021 Tamara Gunkel, University of Münster\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Tabulator from 'block_opencast/tabulator';\nimport $ from 'jquery';\nimport * as str from 'core/str';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Fragment from 'core/fragment';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nfunction getBody(contextid, ocinstanceid, seriesid, formdata) {\n    if (typeof formdata === 'undefined') {\n        formdata = \"\";\n    }\n\n    var params = {ocinstanceid: ocinstanceid, seriesid: seriesid, jsonformdata: formdata};\n    return Fragment.loadFragment('block_opencast', 'series_form', contextid, params);\n}\n\nfunction submitFormAjax(e) {\n    e.preventDefault();\n    var modal = e.data.modal;\n    var contextid = e.data.contextid;\n    var seriestable = window.seriestable;\n    var edited = e.data.edited;\n    var numseriesallowed = e.data.numseriesallowed;\n\n    var changeEvent = document.createEvent('HTMLEvents');\n    changeEvent.initEvent('change', true, true);\n\n    // Run validation functions.\n    modal.getRoot().find(':input').each(function (index, element) {\n        element.dispatchEvent(changeEvent);\n    });\n\n    // Check if there are invalid fields.\n    var invalid = $.merge(\n        modal.getRoot().find('[aria-invalid=\"true\"]'),\n        modal.getRoot().find('.error')\n    );\n\n    if (invalid.length) {\n        invalid.first().focus();\n        return;\n    }\n\n    // Convert all the form elements values to a serialised string.\n    var formData = modal.getRoot().find('form').serialize();\n    var seriestitle = $('.modal #id_title').val();\n\n    // Submit form.\n    Ajax.call([{\n        methodname: 'block_opencast_submit_series_form',\n        args: {contextid: contextid, ocinstanceid: e.data.ocinstanceid, seriesid: e.data.seriesid, jsonformdata: formData},\n        done: function (newseries) {\n            modal.destroy();\n            if(edited) {\n                let row = seriestable.getRows().find(r => r.getData().series === e.data.seriesid);\n                row.update({\"seriesname\": seriestitle});\n            }\n            else {\n                var s = JSON.parse(newseries);\n                seriestable.addRow({'seriesname': s.seriestitle, 'series':s.series, 'isdefault': s.isdefault});\n\n                if(seriestable.getRows().length >= numseriesallowed) {\n                    $(\"#createseries\").hide();\n                    $(\"#importseries\").hide();\n                }\n            }\n        },\n        fail: function (er) {\n            if(er.errorcode === 'metadataseriesupdatefailed') {\n                modal.destroy();\n                displayError(er.message);\n            }\n            else {\n                modal.setBody(getBody(contextid, e.data.ocinstanceid, e.data.seriesid, formData));\n            }\n        }\n    }]);\n}\n\nfunction displayError(message) {\n    var context = {\n        announce: true,\n        closebutton: true,\n        extraclasses: \"\",\n        message: message\n    };\n\n    Templates.render(\"core/notification_error\", context).then(function (m){\n        $('#user-notifications').append(m);\n    }).fail(function() {\n        Notification.alert(message, message);\n    });\n}\n\nfunction loadSeriesTitles(contextid, ocinstanceid, series, seriestable, row) {\n    Ajax.call([{\n        methodname: 'block_opencast_get_series_titles',\n        args: {contextid: contextid, ocinstanceid: ocinstanceid, series: JSON.stringify(series)},\n        done: function (data) {\n            var titles = JSON.parse(data);\n            if (seriestable !== null) {\n                seriestable.getRows().forEach(function (row) {\n                    row.update({\"seriesname\": titles[row.getData().series]});\n                });\n            } else {\n                row.update({\"seriesname\": titles[row.getData().series]});\n            }\n\n        },\n        fail: function (error) {\n            // Show error.\n            if (seriestable !== null) {\n                seriestable.getRows().forEach(function (row) {\n                    row.update({\"seriesname\": error.message});\n                });\n            } else {\n                row.update({\"seriesname\": error.message});\n            }\n        }\n    }]);\n}\n\nexport const init = (contextid, ocinstanceid) => {\n\n    // Load strings\n    var strings = [\n        {key: 'seriesname', component: 'block_opencast'},\n        {key: 'form_seriesid', component: 'block_opencast'},\n        {key: 'default', component: 'block_opencast'},\n        {key: 'noconnectedseries', component: 'block_opencast'},\n        {key: 'createseriesforcourse', component: 'block_opencast'},\n        {key: 'delete_series', component: 'block_opencast'},\n        {key: 'delete_confirm_series', component: 'block_opencast'},\n        {key: 'editseries', component: 'block_opencast'},\n        {key: 'delete', component: 'moodle'},\n        {key: 'loading', component: 'block_opencast'},\n        {key: 'importseries', component: 'block_opencast'},\n        {key: 'importfailed', component: 'block_opencast'},\n        {key: 'form_seriesid', component: 'block_opencast'},\n        {key: 'setdefaultseries_heading', component: 'block_opencast'},\n        {key: 'setdefaultseries', component: 'block_opencast'}\n    ];\n    str.get_strings(strings).then(function (jsstrings) {\n        // Style hidden input.\n        var seriesinput = $('#seriesinput');\n        var numseriesallowed = $('#numseriesallowed').val();\n\n        var seriestable = new Tabulator(\"#seriestable\", {\n            data: JSON.parse(seriesinput.val()),\n            layout: \"fitColumns\",\n            placeholder: jsstrings[3],\n            headerSort: false,\n            dataChanged: function (data) {\n                // Remove empty rows.\n                data = data.filter(value => value.series);\n                data = data.reduce((function (arr, x) {\n                    arr[x.series] = x.isdefault;\n                    return arr;\n                }), {});\n                seriesinput.val(JSON.stringify(data));\n            },\n            dataLoaded: function (data) {\n                // Load series titles.\n                loadSeriesTitles(contextid, ocinstanceid, data.map(x => x['series']), this);\n            },\n            columns: [\n                {title: jsstrings[0], field: \"seriesname\", editable: false},\n                {title: jsstrings[1], field: \"series\", editable: false},\n                {\n                    title: jsstrings[2], field: \"isdefault\",\n                    hozAlign: \"center\",\n                    widthGrow: 0,\n                    formatter: function (cell) {\n                        var input = document.createElement('input');\n                        input.type = 'radio';\n                        input.name = 'defaultseries';\n                        input.checked = cell.getValue();\n                        input.classList.add('ignoredirty');\n                        input.addEventListener('click', function (e) {\n                            e.preventDefault();\n                            ModalFactory.create({\n                                type: ModalFactory.types.SAVE_CANCEL,\n                                title: jsstrings[13],\n                                body: jsstrings[14]\n                            })\n                                .then(function (modal) {\n                                    modal.getRoot().on(ModalEvents.hidden, function () {\n                                        modal.destroy();\n                                    }).bind(this);\n\n                                    modal.getRoot().on(ModalEvents.save, function () {\n                                        Ajax.call([{\n                                            methodname: 'block_opencast_set_default_series',\n                                            args: {contextid: contextid, ocinstanceid: ocinstanceid,\n                                                seriesid: cell.getRow().getData().series},\n                                            done: function () {\n                                                modal.destroy();\n                                                cell.getTable().getRows().forEach(function(row) {\n                                                    if(row === cell.getRow()) {\n                                                        row.update({'isdefault': 1});\n                                                    }\n                                                    else {\n                                                        row.update({'isdefault': 0});\n                                                    }\n                                                });\n                                            },\n                                            fail: function (e) {\n                                                modal.destroy();\n                                                displayError(e.message);\n                                            }\n                                        }]);\n                                    });\n                                    modal.show();\n                                });\n                        });\n                        return input;\n                    }\n                },\n                {\n                    title: \"\", width: 40, headerSort: false, hozAlign: \"center\", formatter:\n                        function () {\n                            return '<i class=\"icon fa fa-edit fa-fw\"></i>';\n                        },\n                    cellClick: function (_, cell) {\n                        ModalFactory.create({\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            title: jsstrings[7],\n                            body: getBody(contextid, ocinstanceid, cell.getRow().getCell(\"series\").getValue())\n                        })\n                            .then(function (modal) {\n                                modal.setSaveButtonText(jsstrings[7]);\n                                modal.setLarge();\n\n                                // Reset modal on every open event.\n                                modal.getRoot().on(ModalEvents.hidden, function () {\n                                    modal.destroy();\n                                }).bind(this);\n\n                                // We want to hide the submit buttons every time it is opened.\n                                modal.getRoot().on(ModalEvents.shown, function () {\n                                    modal.getRoot().append('<style>[data-fieldtype=submit] { display: none ! important; }</style>');\n                                }.bind(this));\n\n                                modal.getRoot().on(ModalEvents.save, function (e) {\n                                    e.preventDefault();\n                                    modal.getRoot().find('form').submit();\n                                });\n                                modal.getRoot().on('submit', 'form', {\n                                    'modal': modal,\n                                    'contextid': contextid,\n                                    'ocinstanceid': ocinstanceid,\n                                    'seriesid': cell.getRow().getCell(\"series\").getValue(),\n                                    'numseriesallowed': numseriesallowed,\n                                    'edited': true\n                                }, submitFormAjax);\n\n                                modal.show();\n                            });\n                    }\n                },\n                {\n                    title: \"\", width: 40, headerSort: false, hozAlign: \"center\", formatter:\n                        function () {\n                            return '<i class=\"icon fa fa-trash fa-fw\"></i>';\n                        },\n                    cellClick: function (e, cell) {\n                        ModalFactory.create({\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            title: jsstrings[5],\n                            body: jsstrings[6]\n                        })\n                            .then(function (modal) {\n                                modal.setSaveButtonText(jsstrings[8]);\n                                modal.getRoot().on(ModalEvents.save, function () {\n                                    Ajax.call([{\n                                        methodname: 'block_opencast_unlink_series',\n                                        args: {contextid: contextid, ocinstanceid: ocinstanceid,\n                                            seriesid: cell.getRow().getData().series},\n                                        done: function (result) {\n                                            modal.destroy();\n                                            let res = JSON.parse(result);\n                                            if(res.error) {\n                                                displayError(res.message);\n                                            }\n                                            else {\n                                                cell.getRow().delete();\n                                                $(\"#createseries\").show();\n                                                $(\"#createseries\").removeClass('d-none');\n                                                $(\"#importseries\").show();\n                                                $(\"#importseries\").removeClass('d-none');\n                                            }\n                                        },\n                                        fail: function (e) {\n                                            modal.destroy();\n                                            displayError(e.message);\n                                        }\n                                    }]);\n                                });\n                                modal.show();\n                            });\n                    }\n                }\n            ],\n        });\n\n        window.seriestable = seriestable;\n\n        // Create new series in modal\n        // Button for connection a new series\n        $('#createseries').click(function () {\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: jsstrings[4],\n                body: getBody(contextid, ocinstanceid, '')\n            })\n                .then(function (modal) {\n                    modal.setSaveButtonText(jsstrings[4]);\n                    modal.setLarge();\n\n                    modal.getRoot().on(ModalEvents.hidden, function () {\n                        modal.destroy();\n                    }).bind(this);\n\n                    // We want to hide the submit buttons every time it is opened.\n                    modal.getRoot().on(ModalEvents.shown, function () {\n                        modal.getRoot().append('<style>[data-fieldtype=submit] { display: none ! important; }</style>');\n                    }.bind(this));\n\n                    modal.getRoot().on(ModalEvents.save, function (e) {\n                        e.preventDefault();\n                        modal.getRoot().find('form').submit();\n                    });\n                    modal.getRoot().on('submit', 'form', {\n                        'modal': modal,\n                        'contextid': contextid,\n                        'ocinstanceid': ocinstanceid,\n                        'seriesid': '',\n                        'numseriesallowed': numseriesallowed,\n                        'edited': false\n                    }, submitFormAjax);\n\n                    modal.show();\n                });\n\n        });\n\n        // Import new series in modal\n        $('#importseries').click(function () {\n            let context = {\n                label: jsstrings[12],\n                required: false,\n                advanced: false,\n                element: {\n                    wrapperid: \"importseriesid_wrapper\",\n                    name: 'importseriesid',\n                    id: 'importseriesid',\n                    type: 'text',\n                    size: 40,\n                    value: ''\n                }\n            };\n\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: jsstrings[10],\n                body: Templates.render(\"core_form/element-text\", context)\n            })\n                .then(function (modal) {\n                    modal.setSaveButtonText(jsstrings[10]);\n                    modal.setLarge();\n\n                    modal.getRoot().on(ModalEvents.hidden, function () {\n                        modal.destroy();\n                    }).bind(this);\n\n                    modal.getRoot().on(ModalEvents.save, function (e) {\n                        e.preventDefault();\n                        var seriesid = $('#importseriesid').val();\n\n                        // Submit form.\n                        Ajax.call([{\n                            methodname: 'block_opencast_import_series',\n                            args: {contextid: contextid, ocinstanceid: ocinstanceid, seriesid: seriesid},\n                            done: function (newseries) {\n                                modal.destroy();\n                                if(seriestable !== undefined) {\n                                    var s = JSON.parse(newseries);\n                                    seriestable.addRow({'seriesname': s.title, 'series':s.id, 'isdefault': s.isdefault});\n\n                                    if(seriestable.getRows().length >= numseriesallowed) {\n                                        $(\"#createseries\").hide();\n                                        $(\"#importseries\").hide();\n                                    }\n                                }\n                            },\n                            fail: function () {\n                                modal.destroy();\n                                displayError(jsstrings[11]);\n                            }\n                        }]);\n                    });\n\n                    modal.show();\n                });\n        });\n    });\n};\n\n"],"file":"block_manage_series.min.js"}