{"version":3,"sources":["../src/block_settings.js"],"names":["init","jsstrings","roles","rolesinputid","metadata","metadatainputid","parent","hide","next","rolestable","Tabulator","data","JSON","parse","layout","dataChanged","filter","value","rolename","val","stringify","columns","title","role","field","editor","widthGrow","cellEdited","cell","getData","includes","getRow","update","getCell","getElement","getElementsByTagName","disabled","actions","permanent","hozAlign","formatter","input","document","createElement","type","checked","getValue","addEventListener","prop","width","headerSort","cellClick","e","ModalFactory","create","types","SAVE_CANCEL","delete_role","body","delete_confirm_role","then","modal","setSaveButtonText","delete","getRoot","on","ModalEvents","save","show","click","addRow","metadatatable","movableRows","rowMoved","getRows","map","row","name","datatype","editorParams","values","required","readonly","param_json","delete_metadata","delete_confirm_metadata"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the opencast block settings.\n *\n * @package    block_opencast\n * @copyright  2021 Tamara Gunkel, University of MÃ¼nster\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Tabulator from 'block_opencast/tabulator';\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nexport const init = (jsstrings, roles, rolesinputid, metadata, metadatainputid) => {\n\n    // Style hidden input.\n    $('#' + rolesinputid).parent().hide();\n    $('#' + rolesinputid).parent().next().hide();// Default value.\n    $('#' + metadatainputid).parent().hide();\n    $('#' + metadatainputid).parent().next().hide(); // Default value.\n\n    var rolestable = new Tabulator(\"#rolestable\", {\n        data: JSON.parse(roles),\n        layout: \"fitColumns\",\n        dataChanged: function (data) {\n            data = data.filter(value => value.rolename);\n            $('#' + rolesinputid).val(JSON.stringify(data));\n        },\n        columns: [\n            {\n                title: jsstrings.role, field: \"rolename\", editor: \"input\", widthGrow: 4, cellEdited: function (cell) {\n                    if (cell.getData().rolename.includes('[USERNAME]') || cell.getData().rolename.includes('[USERNAME_LOW]') ||\n                        cell.getData().rolename.includes('[USERNAME_UP]')) {\n                        // Tick permanent checkbox.\n                        cell.getRow().update({'permanent': 1});\n                        cell.getRow().getCell(\"permanent\").getElement().getElementsByTagName(\"input\")[0].disabled = true;\n                    } else {\n                        cell.getRow().getCell(\"permanent\").getElement().getElementsByTagName(\"input\")[0].disabled = false;\n                    }\n                }\n            },\n            {title: jsstrings.actions, field: \"actions\", editor: \"input\", widthGrow: 1},\n            {\n                title: jsstrings.permanent,\n                field: \"permanent\",\n                hozAlign: \"center\",\n                widthGrow: 0,\n                formatter: function (cell) {\n                    var input = document.createElement('input');\n                    input.type = 'checkbox';\n                    input.checked = cell.getValue();\n                    input.addEventListener('click', function () {\n                        cell.getRow().update({'permanent': $(this).prop('checked') ? 1 : 0});\n                    });\n\n                    if (cell.getData().rolename.includes('[USERNAME]') || cell.getData().rolename.includes('[USERNAME_LOW]') ||\n                        cell.getData().rolename.includes('[USERNAME_UP]')) {\n                        input.disabled = true;\n                    }\n\n                    return input;\n                }\n            },\n            {\n                title: \"\",\n                width: 40,\n                headerSort: false,\n                hozAlign: \"center\",\n                formatter: function () {\n                    return '<i class=\"icon fa fa-trash fa-fw\"></i>';\n                },\n                cellClick: function (e, cell) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: jsstrings.delete_role,\n                        body: jsstrings.delete_confirm_role\n                    })\n                        .then(function (modal) {\n                            modal.setSaveButtonText(jsstrings.delete);\n                            modal.getRoot().on(ModalEvents.save, function () {\n                                cell.getRow().delete();\n                            });\n                            modal.show();\n                        });\n                }\n            }\n        ],\n    });\n\n    $('#addrow-rolestable').click(function () {\n        rolestable.addRow({'permanent': 0});\n    });\n\n    var metadatatable = new Tabulator(\"#metadatatable\", {\n        data: JSON.parse(metadata),\n        layout: \"fitColumns\",\n        movableRows: true,\n        rowMoved: function () {\n            // Order by row position\n            var data = metadatatable.getRows().map(row => row.getData());\n            data = data.filter(value => value.name);\n            $('#' + metadatainputid).val(JSON.stringify(data));\n        },\n        dataChanged: function () {\n            // Order by row position\n            var data = metadatatable.getRows().map(row => row.getData());\n            data = data.filter(value => value.name);\n            $('#' + metadatainputid).val(JSON.stringify(data));\n        },\n        columns: [\n            {title: jsstrings.name, field: \"name\", editor: \"input\", widthGrow: 1, headerSort: false},\n            {\n                title: jsstrings.datatype, field: \"datatype\", widthGrow: 1, headerSort: false, editor: \"select\", editorParams:\n                    {\n                        values: {\n                            'text': 'String (text)',\n                            'select': 'Drop Down (select)',\n                            'autocomplete': 'Arrays (autocomplete)',\n                            'textarea': 'Long Text (textarea)',\n                            'date_time_selector': 'Date Time Selector (datetime)'\n                        }\n                    }\n            },\n            {\n                title: jsstrings.required,\n                field: \"required\", hozAlign: \"center\", widthGrow: 0, headerSort: false, formatter:\n\n                    function (cell) {\n                        var input = document.createElement('input');\n                        input.type = 'checkbox';\n                        input.checked = cell.getValue();\n                        input.addEventListener('click', function () {\n                            cell.getRow().update({'required': $(this).prop('checked') ? 1 : 0});\n                        });\n\n                        return input;\n                    }\n            },\n            {\n                title: jsstrings.readonly,\n                field: \"readonly\", hozAlign: \"center\", widthGrow: 0, headerSort: false, formatter:\n                    function (cell) {\n                        var input = document.createElement('input');\n                        input.type = 'checkbox';\n                        input.checked = cell.getValue();\n                        input.addEventListener('click', function () {\n                            cell.getRow().update({'readonly': $(this).prop('checked') ? 1 : 0});\n                        });\n\n                        return input;\n                    }\n            },\n            {title: jsstrings.param_json, field: \"param_json\", editor: \"textarea\", widthGrow: 2, headerSort: false},\n            {\n                title: \"\", width: 40, headerSort: false, hozAlign: \"center\", formatter:\n                    function () {\n                        return '<i class=\"icon fa fa-trash fa-fw\"></i>';\n                    },\n                cellClick: function (e, cell) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: jsstrings.delete_metadata,\n                        body: jsstrings.delete_confirm_metadata\n                    })\n                        .then(function (modal) {\n                            modal.setSaveButtonText(jsstrings.delete);\n                            modal.getRoot().on(ModalEvents.save, function () {\n                                cell.getRow().delete();\n                            });\n                            modal.show();\n                        });\n                }\n            }\n        ],\n    });\n\n    $('#addrow-metadatatable').click(function () {\n        metadatatable.addRow({'datatype': 'text', 'required': 0, 'readonly': 0, 'param_json': null});\n    });\n};\n\n"],"file":"block_settings.min.js"}