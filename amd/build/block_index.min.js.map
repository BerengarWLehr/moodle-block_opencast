{"version":3,"sources":["../src/block_index.js"],"names":["define","$","ModalFactory","ModalEvents","str","url","initWorkflowModal","ocinstanceid","courseid","langstrings","document","getElementById","workflows","JSON","parse","text","on","e","preventDefault","clickedVideo","currentTarget","select","workflow","title","create","type","types","SAVE_CANCEL","body","relativeUrl","data","then","modal","setSaveButtonText","root","getRoot","save","contentWindow","postMessage","show","html","val","description","attr","change","workflowid","initReportModal","submit","addClass","removeClass","init","get_strings","key","component","results","window","addEventListener","event","origin","parseInt","height"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the opencast block.\n *\n * @package    block_opencast\n * @copyright  2021 Tamara Gunkel, University of MÃ¼nster\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/str', 'core/url'],\n    function ($, ModalFactory, ModalEvents, str, url) {\n\n        var initWorkflowModal = function (ocinstanceid, courseid, langstrings) {\n            if(document.getElementById('workflowsjson')) {\n                var workflows = JSON.parse($('#workflowsjson').text());\n\n                $('.start-workflow').on('click', function (e) {\n                    e.preventDefault();\n                    var clickedVideo = $(e.currentTarget);\n                    var select = '<select class=\"custom-select mb-3\" id=\"workflowselect\" name=\"workflow\">';\n\n                    for (let workflow in workflows) {\n                        select += '<option value=\"' + workflow + '\">' + workflows[workflow].title + '</option>';\n                    }\n\n                    select += '</select>';\n\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: langstrings[5],\n                        body: '<form id=\"startWorkflowForm\" method=\"post\" action=\"' +\n                            url.relativeUrl('blocks/opencast/startworkflow.php', {\n                                'ocinstanceid': ocinstanceid,\n                                'courseid': courseid,\n                                'videoid': clickedVideo.data('id')\n                            }) + '\"><div class=\"form-group\">' +\n                            '<p>' + langstrings[6] + '</p>' + select + '<div id=\"workflowdesc\"></div>' +\n                            '<iframe id=\"config-frame\" class=\"w-100 mh-100 border-0\" sandbox=\"allow-forms allow-scripts\" src=\"\">' +\n                            '</iframe><input type=\"hidden\" name=\"configparams\" id=\"configparams\"></form>'\n                    })\n                        .then(function (modal) {\n                            modal.setSaveButtonText(langstrings[5]);\n                            var root = modal.getRoot();\n                            root.on(ModalEvents.save, function (e) {\n                                document.getElementById('config-frame').contentWindow.postMessage('getdata', '*');\n                                // Handle form submission after receiving data.\n                                e.preventDefault();\n                            });\n\n                            // Show description for initial value.\n                            modal.show().then(function () {\n                                $('#workflowdesc').html(workflows[$('#workflowselect').val()].description);\n                                $('#config-frame').attr('src', url.relativeUrl('blocks/opencast/serveworkflowconfigpanel.php', {\n                                    'ocinstanceid': ocinstanceid,\n                                    'courseid': courseid,\n                                    'workflowid': $('#workflowselect').val()\n                                }));\n\n                                // Show workflow description when selected.\n                                $('#workflowselect').change(function () {\n                                    let workflowid = $(this).val();\n                                    $('#workflowdesc').html(workflows[workflowid].description);\n                                    $('#config-frame').attr('src', url.relativeUrl('blocks/opencast/serveworkflowconfigpanel.php', {\n                                        'ocinstanceid': ocinstanceid,\n                                        'courseid': courseid,\n                                        'workflowid': workflowid\n                                    }));\n                                });\n                            });\n                        });\n                });\n            }\n        };\n\n        var initReportModal = function (ocinstanceid, courseid, langstrings) {\n            $('.report-problem').on('click', function (e) {\n                e.preventDefault();\n                var clickedVideo = $(e.currentTarget);\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: langstrings[0],\n                    body: '<form id=\"reportProblemForm\" method=\"post\" action=\"' +\n                        url.relativeUrl('blocks/opencast/reportproblem.php', {\n                            'ocinstanceid': ocinstanceid,\n                            'courseid': courseid,\n                            'videoid': clickedVideo.data('id')\n                        }) + '\"><div class=\"form-group\">' +\n                        '<label for=\"inputMessage\">' + langstrings[1] + '</label>' +\n                        '<textarea class=\"form-control\" id=\"inputMessage\" name=\"inputMessage\" rows=\"4\" placeholder=\"' +\n                        langstrings[2] + '\">' + '</textarea>' +\n                        '  <div class=\"invalid-feedback d-none\" id=\"messageValidation\">' + langstrings[3] + '</div>' +\n                        '</div></form>'\n                })\n                    .then(function (modal) {\n                        modal.setSaveButtonText(langstrings[4]);\n                        var root = modal.getRoot();\n                        root.on(ModalEvents.save, function (e) {\n                            if ($('#inputMessage').val()) {\n                                $('#reportProblemForm').submit();\n                            } else {\n                                $('#inputMessage').addClass('is-invalid');\n                                $('#messageValidation').removeClass('d-none');\n                            }\n                            e.preventDefault();\n                        });\n                        modal.show();\n\n                    });\n            });\n        };\n\n        /*\n         * Initialise all of the modules for the opencast block.\n         */\n        var init = function (courseid, ocinstanceid) {\n            // Load strings\n            var strings = [\n                {\n                    key: 'reportproblem_modal_title',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'reportproblem_modal_body',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'reportproblem_modal_placeholder',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'reportproblem_modal_required',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'reportproblem_modal_submit',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'startworkflow',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'startworkflow_modal_body',\n                    component: 'block_opencast'\n                }\n            ];\n            str.get_strings(strings).then(function (results) {\n                initWorkflowModal(ocinstanceid, courseid, results);\n                initReportModal(ocinstanceid, courseid, results);\n            });\n            window.addEventListener('message', function (event) {\n                if (event.origin !== \"null\") {\n                    return;\n                }\n\n                if (event.data === parseInt(event.data)) {\n                    $('#config-frame').height(event.data);\n                } else {\n                    $('#configparams').val(event.data);\n                    $('#startWorkflowForm').submit();\n                }\n            });\n        };\n\n        return {\n            init: init\n        };\n    });\n\n"],"file":"block_index.min.js"}