{"version":3,"sources":["../src/block_index.js"],"names":["define","$","ModalFactory","ModalEvents","str","url","initWorkflowModal","courseid","langstrings","workflows","on","e","preventDefault","clickedVideo","currentTarget","select","workflow","title","create","type","types","SAVE_CANCEL","body","relativeUrl","data","then","modal","setSaveButtonText","root","getRoot","save","document","getElementById","contentWindow","postMessage","show","html","val","description","attr","change","workflowid","initReportModal","submit","addClass","removeClass","init","get_strings","key","component","results","window","addEventListener","event","origin","parseInt","height"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to initialise the opencast block.\r\n *\r\n * @package    block_opencast\r\n * @copyright  2021 Tamara Gunkel, University of MÃ¼nster\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/str', 'core/url'],\r\n    function ($, ModalFactory, ModalEvents, str, url) {\r\n\r\n        var initWorkflowModal = function (courseid, langstrings, workflows) {\r\n            $('.start-workflow').on('click', function (e) {\r\n                e.preventDefault();\r\n                var clickedVideo = $(e.currentTarget);\r\n                var select = '<select class=\"custom-select mb-3\" id=\"workflowselect\" name=\"workflow\">';\r\n\r\n                for (let workflow in workflows) {\r\n                    select += '<option value=\"' + workflow + '\">' + workflows[workflow].title + '</option>';\r\n                }\r\n\r\n                select += '</select>';\r\n\r\n                ModalFactory.create({\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    title: langstrings[5],\r\n                    body: '<form id=\"startWorkflowForm\" method=\"post\" action=\"' +\r\n                        url.relativeUrl('blocks/opencast/startworkflow.php', {\r\n                            'courseid': courseid,\r\n                            'videoid': clickedVideo.data('id')\r\n                        }) + '\"><div class=\"form-group\">' +\r\n                        '<p>' + langstrings[6] + '</p>' + select + '<div id=\"workflowdesc\"></div>' +\r\n                        '<iframe id=\"config-frame\" class=\"w-100 mh-100 border-0\" sandbox=\"allow-forms allow-scripts\" src=\"\">' +\r\n                        '</iframe><input type=\"hidden\" name=\"configparams\" id=\"configparams\"></form>'\r\n                })\r\n                    .then(function (modal) {\r\n                        modal.setSaveButtonText(langstrings[5]);\r\n                        var root = modal.getRoot();\r\n                        root.on(ModalEvents.save, function (e) {\r\n                            document.getElementById('config-frame').contentWindow.postMessage('getdata', '*');\r\n                            // Handle form submission after receiving data.\r\n                            e.preventDefault();\r\n                        });\r\n\r\n\r\n                        // Show description for initial value.\r\n                        modal.show().then(function () {\r\n                            $('#workflowdesc').html(workflows[$('#workflowselect').val()].description);\r\n                            $('#config-frame').attr('src', url.relativeUrl('blocks/opencast/serveworkflowconfigpanel.php', {\r\n                                'courseid': courseid,\r\n                                'workflowid': $('#workflowselect').val()\r\n                            }));\r\n\r\n                            // Show workflow description when selected.\r\n                            $('#workflowselect').change(function () {\r\n                                let workflowid = $(this).val();\r\n                                $('#workflowdesc').html(workflows[workflowid].description);\r\n                                $('#config-frame').attr('src', url.relativeUrl('blocks/opencast/serveworkflowconfigpanel.php', {\r\n                                    'courseid': courseid,\r\n                                    'workflowid': workflowid\r\n                                }));\r\n                            });\r\n                        });\r\n                    });\r\n            });\r\n        };\r\n\r\n        var initReportModal = function (courseid, langstrings) {\r\n            $('.report-problem').on('click', function (e) {\r\n                e.preventDefault();\r\n                var clickedVideo = $(e.currentTarget);\r\n                ModalFactory.create({\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    title: langstrings[0],\r\n                    body: '<form id=\"reportProblemForm\" method=\"post\" action=\"' +\r\n                        url.relativeUrl('blocks/opencast/reportproblem.php', {\r\n                            'courseid': courseid,\r\n                            'videoid': clickedVideo.data('id')\r\n                        }) + '\"><div class=\"form-group\">' +\r\n                        '<label for=\"inputMessage\">' + langstrings[1] + '</label>' +\r\n                        '<textarea class=\"form-control\" id=\"inputMessage\" name=\"inputMessage\" rows=\"4\" placeholder=\"' +\r\n                        langstrings[2] + '\">' + '</textarea>' +\r\n                        '  <div class=\"invalid-feedback d-none\" id=\"messageValidation\">' + langstrings[3] + '</div>' +\r\n                        '</div></form>'\r\n                })\r\n                    .then(function (modal) {\r\n                        modal.setSaveButtonText(langstrings[4]);\r\n                        var root = modal.getRoot();\r\n                        root.on(ModalEvents.save, function (e) {\r\n                            if ($('#inputMessage').val()) {\r\n                                $('#reportProblemForm').submit();\r\n                            } else {\r\n                                $('#inputMessage').addClass('is-invalid');\r\n                                $('#messageValidation').removeClass('d-none');\r\n                            }\r\n                            e.preventDefault();\r\n                        });\r\n                        modal.show();\r\n\r\n                    });\r\n            });\r\n        };\r\n\r\n        /*\r\n         * Initialise all of the modules for the opencast block.\r\n         */\r\n        var init = function (courseid, workflows) {\r\n            // Load strings\r\n            var strings = [\r\n                {\r\n                    key: 'reportproblem_modal_title',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'reportproblem_modal_body',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'reportproblem_modal_placeholder',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'reportproblem_modal_required',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'reportproblem_modal_submit',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'startworkflow',\r\n                    component: 'block_opencast'\r\n                },\r\n                {\r\n                    key: 'startworkflow_modal_body',\r\n                    component: 'block_opencast'\r\n                }\r\n            ];\r\n            str.get_strings(strings).then(function (results) {\r\n                initWorkflowModal(courseid, results, workflows);\r\n                initReportModal(courseid, results);\r\n            });\r\n            window.addEventListener('message', function (event) {\r\n                if (event.origin !== \"null\") {\r\n                    return;\r\n                }\r\n\r\n                if (event.data === parseInt(event.data)) {\r\n                    $('#config-frame').height(event.data);\r\n                } else {\r\n                    $('#configparams').val(event.data);\r\n                    $('#startWorkflowForm').submit();\r\n                }\r\n            });\r\n        };\r\n\r\n        return {\r\n            init: init\r\n        };\r\n    });\r\n\r\n"],"file":"block_index.min.js"}