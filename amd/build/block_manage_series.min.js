function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_opencast/block_manage_series",["exports","block_opencast/tabulator","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=l(b);c=l(c);d=k(d);f=l(f);g=l(g);h=l(h);i=l(i);function j(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;j=function(){return a};return a}function k(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=j();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function l(a){return a&&a.__esModule?a:{default:a}}function m(a,b){if("undefined"==typeof b){b={}}var c={jsonformdata:b};return h.default.loadFragment("block_opencast","series_form",a,c)}function n(a){a.preventDefault();var b=a.data.modal,d=a.data.contextid,e=a.data.seriestable,f=document.createEvent("HTMLEvents");f.initEvent("change",!0,!0);b.getRoot().find(":input").each(function(a,b){b.dispatchEvent(f)});var g=c.default.merge(b.getRoot().find("[aria-invalid=\"true\"]"),b.getRoot().find(".error"));if(g.length){g.first().focus();return}var h=b.getRoot().find("form").serialize();i.default.call([{methodname:"block_opencast_submit_series_form",args:{contextid:d,jsonformdata:h},done:function done(a){b.destroy();if(e!==void 0){var c=JSON.parse(a);e.addRow({seriesname:c.seriestitle,series:c.series,isdefault:c.isdefault})}},fail:function fail(){b.setBody(m(d,h))}}])}function o(a,b,c,d){i.default.call([{methodname:"block_opencast_get_series_titles",args:{contextid:a,series:JSON.stringify(b)},done:function done(a){var b=JSON.parse(a);if(null!==c){c.getRows().forEach(function(a){a.update({seriesname:b[a.getData().series]})})}else{d.update({seriesname:b[d.getData().series]})}},fail:function fail(a){if(null!==c){c.getRows().forEach(function(b){b.update({seriesname:a.message})})}else{d.update({seriesname:a.message})}}}])}var p=function(a,e){d.get_strings([{key:"seriesname",component:"block_opencast"},{key:"form_seriesid",component:"block_opencast"},{key:"default",component:"block_opencast"},{key:"noconnectedseries",component:"block_opencast"},{key:"createseriesforcourse",component:"block_opencast"},{key:"delete_series",component:"block_opencast"},{key:"delete_confirm_series",component:"block_opencast"},{key:"editseries",component:"block_opencast"},{key:"delete",component:"moodle"},{key:"loading",component:"block_opencast"}]).then(function(d){var h=(0,c.default)("input[name=\""+e+"\"]"),i=new b.default("#seriestable",{data:JSON.parse(h.val()),layout:"fitColumns",placeholder:d[3],headerSort:!1,dataChanged:function dataChanged(a){a=a.filter(function(a){return a.series});a=a.reduce(function(a,b){a[b.series]=b.isdefault;return a},{});h.val(JSON.stringify(a))},dataLoaded:function dataLoaded(b){o(a,b.map(function(a){return a.series}),this)},columns:[{title:d[0],field:"seriesname",editable:!1},{title:d[1],field:"series",editor:"input",cellEdited:function cellEdited(b){if(/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(b.getValue())){b.getRow().update({seriesname:d[9]});o(a,[b.getValue()],null,b.getRow())}else{b.getRow().update({seriesname:""})}}},{title:d[2],field:"isdefault",hozAlign:"center",widthGrow:0,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({isdefault:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-edit fa-fw\"></i>"},cellClick:function cellClick(b,c){var e="series="+c.getRow().getCell("series").getValue();f.default.create({type:f.default.types.SAVE_CANCEL,title:d[7],body:m(a,e)}).then(function(b){b.setSaveButtonText(d[7]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a},n);b.show()})}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(a,b){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[5],body:d[6]}).then(function(a){a.setSaveButtonText(d[8]);a.getRoot().on(g.default.save,function(){b.getRow().delete()});a.show()})}}]});(0,c.default)("#addrow-seriestable").click(function(){if(0===i.getDataCount()){i.addRow({isdefault:1}).then(function(a){setTimeout(function(){a.getCell("series").edit(!0)},100)})}else{i.addRow({isdefault:0}).then(function(a){setTimeout(function(){a.getCell("series").edit(!0)},100)})}});(0,c.default)("#createseries").click(function(){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[4],body:m(a)}).then(function(b){b.setSaveButtonText(d[4]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.setBody(m(a))}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a,seriestable:i},n);b.show()})})})};a.init=p});
//# sourceMappingURL=block_manage_series.min.js.map
