function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_opencast/block_manage_series",["exports","block_opencast/tabulator","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/templates","core/notification"],function(a,b,c,d,f,g,h,i,j,k){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=n(b);c=n(c);d=m(d);f=n(f);g=n(g);h=n(h);i=n(i);j=n(j);k=n(k);function l(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;l=function(){return a};return a}function m(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=l();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b,c,d){if("undefined"==typeof d){d=""}var e={ocinstanceid:b,seriesid:c,jsonformdata:d};return h.default.loadFragment("block_opencast","series_form",a,e)}function p(a){a.preventDefault();var b=a.data.modal,d=a.data.contextid,e=a.data.seriestable,f=a.data.numseriesallowed,g=document.createEvent("HTMLEvents");g.initEvent("change",!0,!0);b.getRoot().find(":input").each(function(a,b){b.dispatchEvent(g)});var h=c.default.merge(b.getRoot().find("[aria-invalid=\"true\"]"),b.getRoot().find(".error"));if(h.length){h.first().focus();return}var j=b.getRoot().find("form").serialize();i.default.call([{methodname:"block_opencast_submit_series_form",args:{contextid:d,ocinstanceid:a.data.ocinstanceid,seriesid:a.data.seriesid,jsonformdata:j},done:function done(a){b.destroy();if(e!==void 0){var d=JSON.parse(a);e.addRow({seriesname:d.seriestitle,series:d.series,isdefault:d.isdefault});if(e.getRows().length>=f){(0,c.default)("#createseries").hide();(0,c.default)("#importseries").hide()}}},fail:function fail(a){if("metadataseriesupdatefailed"===a.errorcode){b.destroy();q(a.message)}else{b.setBody(o(d,a.data.ocinstanceid,a.data.seriesid,j))}}}])}function q(a){j.default.render("core/notification_error",{announce:!0,closebutton:!0,extraclasses:"",message:a}).then(function(a){(0,c.default)("#user-notifications").append(a)}).fail(function(){k.default.alert(a,a)})}function r(a,b,c,d,e){i.default.call([{methodname:"block_opencast_get_series_titles",args:{contextid:a,ocinstanceid:b,series:JSON.stringify(c)},done:function done(a){var b=JSON.parse(a);if(null!==d){d.getRows().forEach(function(a){a.update({seriesname:b[a.getData().series]})})}else{e.update({seriesname:b[e.getData().series]})}},fail:function fail(a){if(null!==d){d.getRows().forEach(function(b){b.update({seriesname:a.message})})}else{e.update({seriesname:a.message})}}}])}var s=function(a,h){d.get_strings([{key:"seriesname",component:"block_opencast"},{key:"form_seriesid",component:"block_opencast"},{key:"default",component:"block_opencast"},{key:"noconnectedseries",component:"block_opencast"},{key:"createseriesforcourse",component:"block_opencast"},{key:"delete_series",component:"block_opencast"},{key:"delete_confirm_series",component:"block_opencast"},{key:"editseries",component:"block_opencast"},{key:"delete",component:"moodle"},{key:"loading",component:"block_opencast"},{key:"importseries",component:"block_opencast"},{key:"importfailed",component:"block_opencast"},{key:"form_seriesid",component:"block_opencast"},{key:"setdefaultseries_heading",component:"block_opencast"},{key:"setdefaultseries",component:"block_opencast"}]).then(function(d){var e=(0,c.default)("#seriesinput"),k=(0,c.default)("#numseriesallowed").val(),l=new b.default("#seriestable",{data:JSON.parse(e.val()),layout:"fitColumns",placeholder:d[3],headerSort:!1,dataChanged:function dataChanged(a){a=a.filter(function(a){return a.series});a=a.reduce(function(a,b){a[b.series]=b.isdefault;return a},{});e.val(JSON.stringify(a))},dataLoaded:function dataLoaded(b){r(a,h,b.map(function(a){return a.series}),this)},columns:[{title:d[0],field:"seriesname",editable:!1},{title:d[1],field:"series",editable:!1},{title:d[2],field:"isdefault",hozAlign:"center",widthGrow:0,formatter:function formatter(b){var c=document.createElement("input");c.type="radio";c.name="defaultseries";c.checked=b.getValue();c.classList.add("ignoredirty");c.addEventListener("click",function(c){c.preventDefault();f.default.create({type:f.default.types.SAVE_CANCEL,title:d[13],body:d[14]}).then(function(c){c.getRoot().on(g.default.hidden,function(){c.destroy()}).bind(this);c.getRoot().on(g.default.save,function(){i.default.call([{methodname:"block_opencast_set_default_series",args:{contextid:a,ocinstanceid:h,seriesid:b.getRow().getData().series},done:function done(){c.destroy();b.getTable().getRows().forEach(function(a){if(a===b.getRow()){a.update({isdefault:1})}else{a.update({isdefault:0})}})},fail:function fail(a){c.destroy();q(a.message)}}])});c.show()})});return c}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-edit fa-fw\"></i>"},cellClick:function cellClick(b,c){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[7],body:o(a,h,c.getRow().getCell("series").getValue())}).then(function(b){b.setSaveButtonText(d[7]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a,ocinstanceid:h,seriesid:c.getRow().getCell("series").getValue(),numseriesallowed:k},p);b.show()})}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(b,e){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[5],body:d[6]}).then(function(b){b.setSaveButtonText(d[8]);b.getRoot().on(g.default.save,function(){i.default.call([{methodname:"block_opencast_unlink_series",args:{contextid:a,ocinstanceid:h,seriesid:e.getRow().getData().series},done:function done(a){b.destroy();var d=JSON.parse(a);if(d.error){q(d.message)}else{e.getRow().delete();(0,c.default)("#createseries").show();(0,c.default)("#createseries").removeClass("d-none");(0,c.default)("#importseries").show();(0,c.default)("#importseries").removeClass("d-none")}},fail:function fail(a){b.destroy();q(a.message)}}])});b.show()})}}]});(0,c.default)("#createseries").click(function(){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[4],body:o(a,h,"")}).then(function(b){b.setSaveButtonText(d[4]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a,ocinstanceid:h,seriestable:l,seriesid:"",numseriesallowed:k},p);b.show()})});(0,c.default)("#importseries").click(function(){var b={label:d[12],required:!1,advanced:!1,element:{wrapperid:"importseriesid_wrapper",name:"importseriesid",id:"importseriesid",type:"text",size:40,value:""}};f.default.create({type:f.default.types.SAVE_CANCEL,title:d[10],body:j.default.render("core_form/element-text",b)}).then(function(b){b.setSaveButtonText(d[10]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.save,function(f){f.preventDefault();var e=(0,c.default)("#importseriesid").val();i.default.call([{methodname:"block_opencast_import_series",args:{contextid:a,ocinstanceid:h,seriesid:e},done:function done(a){b.destroy();if(l!==void 0){var d=JSON.parse(a);l.addRow({seriesname:d.title,series:d.id,isdefault:d.isdefault});if(l.getRows().length>=k){(0,c.default)("#createseries").hide();(0,c.default)("#importseries").hide()}}},fail:function fail(){b.destroy();q(d[11])}}])});b.show()})})})};a.init=s});
//# sourceMappingURL=block_manage_series.min.js.map
