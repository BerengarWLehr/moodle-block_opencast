{"version":3,"sources":["../src/block_workflow_settings.js"],"names":["define","$","ModalFactory","ModalEvents","str","url","ajax","notification","initConfig","langStrings","on","e","preventDefault","workflowid","currentTarget","data","create","type","types","DEFAULT","title","body","relativeUrl","then","modal","show","initDelete","id","workflowdefid","SAVE_CANCEL","replace","setSaveButtonText","getRoot","save","call","methodname","args","done","res","success","remove","alert","fail","init","get_strings","key","component","results","addClass","window","addEventListener","event","origin","height"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the configuration panels for workflow definitions.\n *\n * @package    block_opencast\n * @copyright  2021 Tamara Gunkel, University of MÃ¼nster\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/str', 'core/url', 'core/ajax', 'core/notification'],\n    function ($, ModalFactory, ModalEvents, str, url, ajax, notification) {\n\n        var initConfig = function (langStrings) {\n            $('button[data-class=\"config_workflow\"]').on('click', function (e) {\n                e.preventDefault();\n                var workflowid = $(e.currentTarget).data('id');\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: langStrings[0],\n                    body: '<iframe id=\"config-frame\" class=\"w-100 mh-100 border-0\" sandbox=\"allow-forms allow-scripts\" src=\"' +\n                        url.relativeUrl('blocks/opencast/serveworkflowconfigpanel.php', {\n                            'workflowid': workflowid\n                        }) + '\"</iframe>'\n                })\n                    .then(function (modal) {\n                        modal.show();\n                    });\n            });\n        };\n\n        var initDelete = function (langStrings) {\n            $('button[data-class=\"del_workflow\"]').on('click', function (e) {\n                e.preventDefault();\n                var id = $(e.currentTarget).data('id');\n                var workflowdefid = $(e.currentTarget).data('defid');\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: langStrings[1],\n                    body: langStrings[2].replace('%WORKFLOW%', workflowdefid)\n                })\n                    .then(function (modal) {\n                        modal.setSaveButtonText(langStrings[3]);\n                        modal.getRoot().on(ModalEvents.save, function () {\n                            ajax.call([{\n                                methodname: 'block_opencast_delete_workflow',\n                                args: {id: id},\n                                done: function (res) {\n                                    if (res.success) {\n                                        $('#workflow_' + workflowdefid).remove();\n                                        $('#fitem_id_delete_' + id).remove();\n                                    } else {\n                                        notification.alert(langStrings[4], langStrings[5]);\n                                    }\n                                },\n                                fail: function() {\n                                    notification.alert(langStrings[4], langStrings[5]);\n                                }\n                            }]);\n                        });\n                        modal.show();\n                    });\n            });\n        };\n\n        /*\n         * Initialise all of the modules for the opencast block.\n         */\n        var init = function () {\n            // Load strings\n            var strings = [\n                {\n                    key: 'configworkflow_modal_title',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'workflow_delete',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'workflow_delete_confirm',\n                    component: 'block_opencast'\n                },\n                {\n                    key: 'delete'\n                },\n                {\n                    key: 'error'\n                },\n                {\n                    key: 'workflow_delete_error',\n                    component: 'block_opencast'\n                }\n            ];\n            str.get_strings(strings).then(function (results) {\n                initConfig(results);\n                initDelete(results);\n            });\n\n            $('button[data-class=\"del_workflow\"]').addClass('btn-danger');\n\n            window.addEventListener('message', function (event) {\n                if (event.origin !== \"null\") {\n                    return;\n                }\n                $('#config-frame').height(event.data);\n            });\n        };\n\n        return {\n            init: init\n        };\n    });\n\n"],"file":"block_workflow_settings.min.js"}